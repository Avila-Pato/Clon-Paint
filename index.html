<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Clon-Paint</title>
    <style>
          *,
    *::before,
    *::after {
      box-sizing: border-box;
    }

    body {
      font-family: 'Arial', sans-serif;
      background: #222;
      padding: 16px;
      max-width: 500px;
      margin: 0 auto;
    }

    h1 {
      color: #fce300;
      font-size: 12px;
      font-weight: 600;

      display: flex;
      justify-content: center;
      align-items: center;
      gap: 4px;

      img {
        width: 16px;
        height: auto;
      }
    }

    canvas {
      background: #fff;
    }

    header {
      grid-area: header;
      background: silver;
      padding: 2px;

      button {
        border: 0;
        background: transparent;

        &:hover {
          box-shadow:
            1px 1px black,
            inset -1px -1px gray,
            inset 1px 1px white;
        }
      }
    }
        main {
      grid-area: main;
      padding: 16px;
    }

    footer {
      grid-area: footer;
      background: silver;
      padding: 4px;
    }

    #container {
      border: 1px solid #808080;
      display: grid;
      grid-template-areas:
        "header header header"
        "aside main main"
        "footer footer footer";
    }

    aside {
      background: silver;
      grid-area: aside;
      width: 52px;
      padding-top: 2px;

      nav {
        display: flex;
        flex-wrap: wrap;
        gap: 1px;
        justify-content: center;
      }

      button {
        width: 24px;
        height: 24px;

        background: #bdbdbd url('./icons/draw.png') no-repeat center;

        border: 1.5px solid #eee;
        border-right-color: #000;
        border-bottom-color: #000;

        image-rendering: pixelated;

        &.active {
          background-color: #eee;
          border-color: #000;
          border-right-color: #eee;
          border-bottom-color: #eee;
        }

        &[disabled] {
          pointer-events: none;
          opacity: .5;
        }
      }
    }

    #erase-btn {
      background-image: url('./icons/erase.png');
    }

    #rectangle-btn {
      background-image: url('./icons/rectangle.png');
    }

    #ellipse-btn {
      background-image: url('./icons/ellipse.png');
    }

    #picker-btn {
      background-image: url('./icons/picker.png');
    }

    #clear-btn {
      background-image: url('./icons/trash.png');
      background-size: 18px;
    }

    </style>
    <script type="module">
        // se haran las contantes para poder utilizarlas en el codigo es como una especie 
        // de diccionario
        const MODES = {
            DRAW: 'draw',
            ERASER: 'eraser',
            RECTANGLE: 'rectangle',
            ELLIPSE: 'ellipse',
            PICKER: 'picker',
        }
        // Función $ para seleccionar el primer elemento que coincida con el selector
        const $ = selector => document.querySelector(selector);
        // Función $$ para seleccionar todos los elementos que coincidan con el selector
        const $$ = selector => document.querySelectorAll(selector);
       

        //eLEMENTO DEL CANVAS
        const canvas = $('#canvas');
        // RECUPERAR EL INPUT DEL COLOR
        const $colorPicker = $('#color-picker');
        // CONTEXT DEL CANVAS
        const ctx = canvas.getContext('2d');
        
        // ESTADO DEL CANVAS 
        let isDrawing = false;
        // Donde empieza el dibujo
        let startX, startY
        // COORDENADAS DEL CANVAS
        let lastX = 0
        let lastY = 0
        let mode = MODES.DRAW; // Modo actual del lienzo (puede ser 'draw', 'eraser', 'rectangle',
        // 'ellipse' o 'picker') esta lo toma de la constante MODES
        // Dibujar el rectangulo
        let isDrawingRectangle = null;

        // Eventos para saber cuando se esta dibujando
        canvas.addEventListener('mousedown', startDrawing);
        // Eventos para saber cuando se esta moviendo el mouse
        canvas.addEventListener('mousemove', draw);
        // Eventos para saber cuando se deja de dibujar
        canvas.addEventListener('mouseup', stopDrawing);
        // Eventos cuando salimos del canvas
        canvas.addEventListener('mouseleave', stopDrawing);
        
        
        // Evento para selleccionar el color
        $colorPicker.addEventListener('change', handleChangeColor);

        //Definiendo Metodos para dibujar
        function startDrawing(event) {
           isDrawing = true;
           const { offsetX, offsetY } = event;
            // guardar las coordenadas iniciales
            [startX, startY] = [offsetX, offsetY];
            [lastX, lastY] = [offsetX, offsetY];


            // photo del canvas
            isDrawingRectangle = ctx.getImageData(0, 0, canvas.width, canvas.height);

        }
        function draw(event) {
            // si no se esta dibujando osea si no se apreta el click, no hacer nada
           if(!isDrawing) return;

           
           // recuperar las coordenadas actuales
           const { offsetX, offsetY } = event;

           // cambiar el tipo de lienzo 

           if(mode === MODES.DRAW){
           //comenzar trazado
           ctx.beginPath();
           // mover hasta la ultima pocicion conocida
           ctx.moveTo(lastX, lastY);
           // dibujar una linea hasta la posicion actual con als coordenadas actuales
           ctx.lineTo(offsetX, offsetY);
           // dibujar la linea
           ctx.stroke();

           // actualzar las ultimas coordenadas 
           [lastX, lastY] = [offsetX, offsetY];

           return
        }
        // Dibujar un rectangulo
        if(mode === MODES.RECTANGLE){
            // poner imagen que tenemos guardada evitando que se repita o se conserve a cada rato
            ctx.putImageData(isDrawingRectangle, 0, 0);
            // dibujar un rectangulo desde el putno inicial hasta el final
          const width = offsetX - startX;
          const height = offsetY - startY;

          //comenzar trazado 
          ctx.beginPath();
          // dibujar un rectangulo desde el punto inicial hasta el final
          ctx.rect(startX, startY, width, height);
          // dibujar el rectangulo
          ctx.stroke();
          return
        }
    }

        function stopDrawing() {
            isDrawing = false;
        }

        // Cambiar el color del lienzo
            function handleChangeColor() {
                const {value} = $colorPicker;
                ctx.strokeStyle = value;
            }

    </script>
</head>
<body>
    <h1> 
        <img src="icons/icon.png" alt="">
        Paint.js
    </h1>
    <div id="container">

        <header>
            <button>Fields</button>
            <button>Edit</button>
            <button>View</button> 
            <button>Image</button>  
            <button>Options</button>  
            <button>Help</button>   
        </header>

        <aside>
            <button class="active" id="draw-btn" title="Pincel"></button>
            <button id="erase-btn" title="Borrador"></button>
            <button id="rectangle-btn" title="Rectangulo"></button>
            <button id="ellipse-btn" title="Elipse"></button>
            <button id="picker-btn" title="Seleccionar color"></button>
            <button id="clear-btn" title="Limpiar"></button>
        </aside>
        
        <main>
            <canvas id="canvas" width="315" height="200"></canvas>
        </main>
        
        <footer>
            <input type="color" id="color-picker" value="#000000">
        </footer>
    </div>

</body>
</html>
